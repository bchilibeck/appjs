// Generated by CoffeeScript 1.3.3
(function() {

  $(function() {
    return $("a[href=\"/favorite-icon/\"], span[data-favorite]").on("click", function(e) {
      var $el, $jqXHR;
      $el = $(this);
      e.preventDefault();
      $jqXHR = $.ajax({
        url: "/favorite-icon/",
        type: "POST",
        data: {
          csrfmiddlewaretoken: $("meta[name='csrf-token']").attr('content'),
          icon_id: $el.attr("data-icon-id")
        }
      });
      return $jqXHR.success(function(data) {
        var eventLabel, heart, iconID, thisIcon;
        $el.removeClass("favored");
        $el.removeClass("unfavored");
        if (parseInt(data.state, 10) === 1) {
          thisIcon = $el.data('icon-id');
          eventLabel = "The following item number: " + thisIcon + " was favorited.";
          _gaq.push(['_trackEvent', 'Favorite', 'Favorited-Item', eventLabel]);
          $el.addClass('favored');
          heart = '<div id="favorite-confirmation"><span class="icon"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100px" height="91.46px" viewBox="0 0 100 91.46" enable-background="new 0 0 100 91.46" space="preserve"> <path d="M49.999,91.46c3.944-3.943,26.458-26.471,40.533-40.543c12.61-12.611,12.341-30.993,0.876-42.396 C79.943-2.884,61.404-2.834,49.999,8.632C38.595-2.834,20.056-2.884,8.591,8.522C-2.874,19.925-3.142,38.306,9.467,50.917 C23.541,64.99,46.058,87.517,49.999,91.46z"></path> </svg></span></div>';
        } else {
          $el.addClass('unfavored');
          heart = '<div id="favorite-confirmation"><span class="icon"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"	 width="100px" height="91.46px" viewBox="0 0 100 91.46" enable-background="new 0 0 100 91.46" xml:space="preserve"><path d="M33.389,49.236l14.137-14.138L33.409,20.99L47.782,6.617C36.307-2.795,19.341-2.171,8.591,8.522	C-2.874,19.925-3.142,38.306,9.467,50.917c8.039,8.037,18.828,18.828,27.341,27.345l12.81-12.812L33.389,49.236z"/><path d="M91.408,8.521C80.119-2.708,61.978-2.825,50.536,8.119l0.047,0.028L37.656,20.985l14.109,14.11L37.638,49.228l16.358,16.354	L39.06,80.516c5.322,5.324,9.453,9.457,10.939,10.944c3.943-3.943,26.458-26.471,40.534-40.543	C103.142,38.306,102.873,19.924,91.408,8.521z"/></svg></span></div>';
        }
        $('body').append(heart);
        $('#favorite-confirmation').delay(600).fadeOut(400).delay(100).queue(function() {
          return $('#favorite-confirmation').remove();
        });
        if ($("#user-profile #favorited-icons").length > 0) {
          if ($el.hasClass('unfavored')) {
            $el.parents('#favorited-icons li').delay(100).fadeOut(200, function() {
              if (!$("li.icon:visible").exists()) {
                return window.location.reload();
              }
            });
          } else {
            if ($el.parents('ul').hasClass('no-icons')) {
              window.location.reload();
            }
          }
        }
        if ($('#noun-detail').length > 0) {
          iconID = $el.attr('data-icon-id');
          if ($el.hasClass('unfavored')) {
            return $('#icon-' + iconID).data('favorite', 'unfavored');
          } else {
            return $('#icon-' + iconID).data('favorite', 'favored');
          }
        }
      });
    });
  });

}).call(this);
